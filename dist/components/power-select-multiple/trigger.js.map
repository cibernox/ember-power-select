{"version":3,"file":"trigger.js","sources":["../../../src/components/power-select-multiple/trigger.ts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { action } from '@ember/object';\nimport { get } from '@ember/object';\nimport type { Select, TSearchFieldPosition } from '../power-select';\nimport type { ComponentLike } from '@glint/template';\nimport { modifier } from 'ember-modifier';\nimport { deprecate } from '@ember/debug';\nimport type Owner from '@ember/owner';\n\ninterface PowerSelectMultipleTriggerSignature {\n  Element: HTMLElement;\n  Args: {\n    select: Select;\n    searchEnabled: boolean;\n    placeholder?: string;\n    searchField: string;\n    searchFieldPosition?: TSearchFieldPosition;\n    listboxId?: string;\n    tabindex?: string;\n    ariaLabel?: string;\n    ariaLabelledBy?: string;\n    ariaDescribedBy?: string;\n    role?: string;\n    ariaActiveDescendant: string;\n    extra?: any;\n    placeholderComponent?: string | ComponentLike<any>;\n    selectedItemComponent?: string | ComponentLike<any>;\n    onInput?: (e: InputEvent) => boolean;\n    onKeydown?: (e: KeyboardEvent) => boolean;\n    onFocus?: (e: FocusEvent) => void;\n    onBlur?: (e: FocusEvent) => void;\n    buildSelection: (lastSelection: any, select: Select) => any[];\n  };\n  Blocks: {\n    default: [opt: any, select: Select];\n  };\n}\n\ninterface IndexAccesible<T> {\n  objectAt(index: number): T;\n}\nconst isIndexAccesible = <T>(target: any): target is IndexAccesible<T> => {\n  return typeof target.objectAt === 'function';\n};\n\nexport default class TriggerComponent extends Component<PowerSelectMultipleTriggerSignature> {\n  private _lastIsOpen: boolean = this.args.select.isOpen;\n\n  constructor(owner: Owner, args: PowerSelectMultipleTriggerSignature['Args']) {\n    super(owner, args);\n    deprecate(\n      'You are using the `<PowerSelectMultiple::Trigger>` component. Replace all usages with the `<PowerSelect::Trigger>` component.',\n      false,\n      {\n        for: 'ember-power-select',\n        id: 'ember-power-select.deprecate-power-select-multiple-trigger',\n        since: {\n          enabled: '8.11',\n          available: '8.11',\n        },\n        until: '9.0.0',\n      },\n    );\n  }\n\n  // Actions\n  @action\n  openChanged(element: Element, [isOpen]: [boolean]) {\n    deprecate(\n      'You are using a power-select-multiple trigger with ember/render-modifier. Replace {{did-update this.openChanged @select.isOpen}} with {{this.openChange @select.isOpen}}.',\n      false,\n      {\n        for: 'ember-power-select',\n        id: 'ember-power-select.no-at-ember-render-modifiers',\n        since: {\n          enabled: '8.1',\n          available: '8.1',\n        },\n        until: '9.0.0',\n      },\n    );\n\n    this._openChanged(element, [isOpen]);\n  }\n\n  @action\n  chooseOption(e: Event) {\n    if (e.target === null) return;\n    const selectedIndex = (e.target as Element).getAttribute(\n      'data-selected-index',\n    );\n    if (selectedIndex) {\n      const numericIndex = parseInt(selectedIndex, 10);\n      e.stopPropagation();\n      e.preventDefault();\n      const object = this.selectedObject(\n        this.args.select.selected,\n        numericIndex,\n      );\n      this.args.select.actions.choose(object);\n    }\n  }\n\n  openChange = modifier((element: Element, [isOpen]: [boolean]) => {\n    this._openChanged(element, [isOpen]);\n  });\n\n  private _openChanged(_el: Element, [isOpen]: [boolean]) {\n    if (isOpen === false && this._lastIsOpen === true) {\n      Promise.resolve().then(() => {\n        this.args.select.actions?.search('');\n      });\n    }\n    this._lastIsOpen = isOpen;\n  }\n\n  selectedObject<T>(list: IndexAccesible<T> | T[], index: number): T {\n    if (isIndexAccesible(list)) {\n      return list.objectAt(index);\n    } else {\n      return get(list, index) as T;\n    }\n  }\n}\n"],"names":["isIndexAccesible","target","objectAt","TriggerComponent","Component","_lastIsOpen","args","select","isOpen","constructor","owner","deprecate","for","id","since","enabled","available","until","openChanged","element","_openChanged","n","prototype","action","chooseOption","e","selectedIndex","getAttribute","numericIndex","parseInt","stopPropagation","preventDefault","object","selectedObject","selected","actions","choose","openChange","modifier","_el","Promise","resolve","then","search","list","index","get","setComponentTemplate","TEMPLATE"],"mappings":"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"}