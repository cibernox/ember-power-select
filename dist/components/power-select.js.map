{"version":3,"file":"power-select.js","sources":["../../src/components/power-select.ts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { action, get } from '@ember/object';\nimport { guidFor } from '@ember/object/internals';\nimport { addObserver, removeObserver } from '@ember/object/observers';\nimport { isEqual, isNone } from '@ember/utils';\nimport { assert, deprecate } from '@ember/debug';\nimport {\n  indexOfOption,\n  filterOptions,\n  findOptionWithOffset,\n  countOptions,\n  defaultHighlighted,\n  advanceSelectableOption,\n  defaultMatcher,\n  defaultTypeAheadMatcher,\n  pathForOption,\n  type MatcherFn,\n} from '../utils/group-utils.ts';\nimport { restartableTask, timeout } from 'ember-concurrency';\nimport { modifier } from 'ember-modifier';\nimport type {\n  Dropdown,\n  DropdownActions,\n  TRootEventType,\n} from 'ember-basic-dropdown/components/basic-dropdown';\nimport type Owner from '@ember/owner';\nimport type { CalculatePosition } from 'ember-basic-dropdown/utils/calculate-position';\nimport { isArray } from '@ember/array';\nimport type { ComponentLike } from '@glint/template';\n\ninterface SelectActions extends DropdownActions {\n  search: (term: string) => void;\n  highlight: (option: any) => void;\n  select: (selected: any, e?: Event) => void;\n  choose: (selected: any, e?: Event) => void;\n  scrollTo: (option: any) => void;\n  labelClick: (e: MouseEvent) => void;\n}\nexport interface Select extends Dropdown {\n  selected: any;\n  multiple: boolean;\n  highlighted: any;\n  options: readonly any[];\n  results: readonly any[];\n  resultsCount: number;\n  loading: boolean;\n  isActive: boolean;\n  searchText: string;\n  lastSearchedText: string;\n  actions: SelectActions;\n}\ninterface PromiseProxy<T> extends Promise<T> {\n  content: any;\n}\ninterface CancellablePromise<T> extends Promise<T> {\n  cancel: () => void;\n}\ninterface Sliceable<T> {\n  slice(): T[];\n}\n// Some args are not listed here because they are only accessed from the template. Should I list them?\nexport interface PowerSelectArgs {\n  highlightOnHover?: boolean;\n  placeholderComponent?: string | ComponentLike<any>;\n  searchMessage?: string;\n  searchMessageComponent?: string | ComponentLike<any>;\n  noMatchesMessage?: string;\n  noMatchesMessageComponent?: string | ComponentLike<any>;\n  matchTriggerWidth?: boolean;\n  resultCountMessage?: (resultCount: number) => string;\n  options?: readonly any[] | Promise<readonly any[]>;\n  selected?: any | PromiseProxy<any>;\n  multiple?: boolean;\n  legacyMultiple?: boolean; // Don't use this inside app, internal usage!\n  destination?: string;\n  destinationElement?: HTMLElement;\n  closeOnSelect?: boolean;\n  renderInPlace?: boolean;\n  preventScroll?: boolean;\n  defaultHighlighted?: any;\n  searchField?: string;\n  labelClass?: string;\n  labelText?: string;\n  labelClickAction?: TLabelClickAction;\n  ariaLabel?: string;\n  ariaLabelledBy?: string;\n  loadingMessage?: string;\n  placeholder?: string;\n  dropdownClass?: string;\n  allowClear?: boolean;\n  searchEnabled?: boolean;\n  animationEnabled?: boolean;\n  tabindex?: number | string;\n  searchPlaceholder?: string;\n  searchFieldPosition?: TSearchFieldPosition;\n  verticalPosition?: string;\n  horizontalPosition?: string;\n  triggerId?: string;\n  disabled?: boolean;\n  title?: string;\n  triggerRole?: string;\n  required?: string;\n  triggerClass?: string;\n  ariaInvalid?: string;\n  eventType?: string;\n  rootEventType?: TRootEventType;\n  ariaDescribedBy?: string;\n  calculatePosition?: CalculatePosition;\n  ebdTriggerComponent?: string | ComponentLike<any>;\n  ebdContentComponent?: string | ComponentLike<any>;\n  labelComponent?: string | ComponentLike<any>;\n  triggerComponent?: string | ComponentLike<any>;\n  selectedItemComponent?: string | ComponentLike<any>;\n  beforeOptionsComponent?: string | ComponentLike<any>;\n  optionsComponent?: string | ComponentLike<any>;\n  groupComponent?: string | ComponentLike<any>;\n  afterOptionsComponent?: string | ComponentLike<any>;\n  extra?: any;\n  matcher?: MatcherFn;\n  initiallyOpened?: boolean;\n  typeAheadOptionMatcher?: MatcherFn;\n  buildSelection?: (selected: any, select: Select) => any;\n  onChange: (selection: any, select: Select, event?: Event) => void;\n  search?: (\n    term: string,\n    select: Select,\n  ) => readonly any[] | Promise<readonly any[]>;\n  onOpen?: (select: Select, e: Event) => boolean | void | undefined;\n  onClose?: (select: Select, e: Event) => boolean | void | undefined;\n  onInput?: (term: string, select: Select, e: Event) => string | boolean | void;\n  onKeydown?: (select: Select, e: KeyboardEvent) => boolean | void | undefined;\n  onFocus?: (select: Select, event: FocusEvent) => void;\n  onBlur?: (select: Select, event: FocusEvent) => void;\n  scrollTo?: (option: any, select: Select) => void;\n  registerAPI?: (select: Select) => void;\n}\n\nexport type TLabelClickAction = 'focus' | 'open';\nexport type TSearchFieldPosition = 'before-options' | 'trigger';\n\nexport interface PowerSelectSignature {\n  Element: HTMLElement;\n  Args: PowerSelectArgs;\n  Blocks: {\n    default: [option: any, select: Select];\n  };\n}\n\nconst isSliceable = <T>(coll: any): coll is Sliceable<T> => {\n  return isArray(coll);\n};\n\nconst isPromiseLike = <T>(thing: any): thing is Promise<T> => {\n  return typeof thing.then === 'function';\n};\n\nconst isPromiseProxyLike = <T>(thing: any): thing is PromiseProxy<T> => {\n  return isPromiseLike(thing) && Object.hasOwnProperty.call(thing, 'content');\n};\n\nconst isCancellablePromise = <T>(\n  thing: any,\n): thing is CancellablePromise<T> => {\n  return typeof thing.cancel === 'function';\n};\n\nexport default class PowerSelectComponent extends Component<PowerSelectSignature> {\n  // Untracked properties\n  _publicAPIActions = {\n    search: this._search,\n    highlight: this._highlight,\n    select: this._select,\n    choose: this._choose,\n    scrollTo: this._scrollTo,\n    labelClick: this._labelClick,\n  };\n\n  // Tracked properties\n  @tracked private _resolvedOptions?: readonly any[];\n  @tracked private _resolvedSelected?: any;\n  @tracked private _repeatingChar = '';\n  @tracked private _expirableSearchText = '';\n  @tracked private _searchResult?: readonly any[];\n  @tracked isActive = false;\n  @tracked loading = false;\n  @tracked searchText = '';\n  @tracked lastSearchedText = '';\n  @tracked highlighted?: any;\n  storedAPI!: Select;\n\n  private _uid = guidFor(this);\n  private _lastOptionsPromise?: Promise<readonly any[]>;\n  private _lastSelectedPromise?: PromiseProxy<any>;\n  private _lastSearchPromise?:\n    | Promise<readonly any[]>\n    | CancellablePromise<readonly any[]>;\n  private _filterResultsCache: {\n    results: any[];\n    options: any[];\n    searchText: string;\n  } = { results: [], options: [], searchText: this.searchText };\n\n  // Lifecycle hooks\n  constructor(owner: Owner, args: PowerSelectArgs) {\n    super(owner, args);\n    assert(\n      '<PowerSelect> requires an `@onChange` function',\n      this.args.onChange && typeof this.args.onChange === 'function',\n    );\n  }\n\n  willDestroy() {\n    if (\n      this._lastSelectedPromise &&\n      isPromiseProxyLike(this._lastSelectedPromise)\n    ) {\n      try {\n        removeObserver(\n          this._lastSelectedPromise,\n          'content',\n          this,\n          this._selectedObserverCallback,\n        );\n        // eslint-disable-next-line no-empty\n      } catch {}\n      this._lastSelectedPromise = undefined;\n    }\n    super.willDestroy();\n  }\n\n  // Getters\n  get highlightOnHover(): boolean {\n    return this.args.highlightOnHover === undefined\n      ? true\n      : this.args.highlightOnHover;\n  }\n\n  get labelClickAction(): TLabelClickAction {\n    return this.args.labelClickAction === undefined\n      ? 'focus'\n      : this.args.labelClickAction;\n  }\n\n  get highlightedIndex(): string {\n    const results = this.results;\n    const highlighted = this.highlighted;\n    return pathForOption(results, highlighted);\n  }\n\n  get searchMessage(): string {\n    return this.args.searchMessage === undefined\n      ? 'Type to search'\n      : this.args.searchMessage;\n  }\n\n  get noMatchesMessage(): string {\n    return this.args.noMatchesMessage === undefined\n      ? 'No results found'\n      : this.args.noMatchesMessage;\n  }\n\n  get resultCountMessage(): string {\n    if (typeof this.args.resultCountMessage === 'function') {\n      return this.args.resultCountMessage(this.resultsCount);\n    }\n\n    if (this.resultsCount === 1) {\n      return `${this.resultsCount} result`;\n    }\n\n    return `${this.resultsCount} results`;\n  }\n\n  get matchTriggerWidth() {\n    return this.args.matchTriggerWidth === undefined\n      ? true\n      : this.args.matchTriggerWidth;\n  }\n\n  get mustShowSearchMessage(): boolean {\n    return (\n      !this.loading &&\n      this.searchText.length === 0 &&\n      !!this.args.search &&\n      !!this.searchMessage &&\n      this.resultsCount === 0\n    );\n  }\n\n  get mustShowNoMessages(): boolean {\n    return (\n      !this.loading &&\n      this.resultsCount === 0 &&\n      (!this.args.search || this.lastSearchedText.length > 0)\n    );\n  }\n\n  get results(): any[] {\n    if (this.searchText.length > 0) {\n      if (this.args.search) {\n        return toPlainArray(this._searchResult || this.options);\n      } else {\n        if (\n          this._filterResultsCache.options === this.options &&\n          this._filterResultsCache.searchText === this.searchText\n        ) {\n          // This is an optimization to avoid filtering several times, which may be a bit expensive\n          // if there are many options, if neither the options nor the searchtext have changed\n          return this._filterResultsCache.results;\n        }\n        const results = this._filter(this.options, this.searchText);\n        // eslint-disable-next-line ember/no-side-effects\n        this._filterResultsCache = {\n          results,\n          options: this.options,\n          searchText: this.searchText,\n        };\n        return results;\n      }\n    } else {\n      return this.options;\n    }\n  }\n\n  get options(): any[] {\n    if (this._resolvedOptions) return toPlainArray(this._resolvedOptions);\n    if (this.args.options) {\n      return toPlainArray(this.args.options as any[]);\n    } else {\n      return [];\n    }\n  }\n\n  get resultsCount(): number {\n    return countOptions(this.results);\n  }\n\n  get selected(): any {\n    if (this._resolvedSelected) {\n      return toPlainArray(this._resolvedSelected);\n    } else if (\n      !isNone(this.args.selected) &&\n      typeof this.args.selected.then !== 'function'\n    ) {\n      return toPlainArray(this.args.selected);\n    }\n    return undefined;\n  }\n\n  get ariaMultiSelectable(): boolean {\n    return isArray(this.args.selected);\n  }\n\n  get triggerId(): string {\n    return this.args.triggerId || `${this._uid}-trigger`;\n  }\n\n  get labelId(): string {\n    return `${this._uid}-label`;\n  }\n\n  get ariaLabelledBy(): string | undefined {\n    if (this.args.ariaLabelledBy) {\n      return this.args.ariaLabelledBy;\n    }\n\n    if (this.args.labelText || this.args.labelComponent) {\n      return this.labelId;\n    }\n  }\n\n  get searchFieldPosition(): TSearchFieldPosition {\n    if (this.args.searchFieldPosition !== undefined) {\n      return this.args.searchFieldPosition;\n    }\n\n    if (this.args.multiple) {\n      return 'trigger';\n    }\n\n    return 'before-options';\n  }\n\n  get tabindex(): string | number {\n    if (this.args.multiple) {\n      if (this.args.triggerComponent === undefined && this.args.searchEnabled) {\n        return '-1';\n      } else {\n        return this.args.tabindex || '0';\n      }\n    }\n\n    if (\n      this.args.searchEnabled &&\n      this.args.tabindex === undefined &&\n      this.searchFieldPosition === 'trigger'\n    ) {\n      return '-1';\n    }\n\n    return this.args.tabindex || '0';\n  }\n\n  get buildSelection(): ((selected: any, select: Select) => any) | undefined {\n    if (this.args.buildSelection) {\n      return this.args.buildSelection;\n    }\n\n    if (this.args.multiple) {\n      return this._defaultMultipleBuildSelection;\n    }\n  }\n\n  // Actions\n  @action\n  handleOpen(_select: Select, e: Event): boolean | void {\n    if (this.args.onOpen && this.args.onOpen(this.storedAPI, e) === false) {\n      return false;\n    }\n\n    this.focusInput(this.storedAPI);\n\n    if (e) {\n      if (\n        e instanceof KeyboardEvent &&\n        e.type === 'keydown' &&\n        (e.keyCode === 38 || e.keyCode === 40)\n      ) {\n        e.preventDefault();\n      }\n    }\n    this._resetHighlighted();\n  }\n\n  @action\n  handleClose(_select: Select, e: Event): boolean | void {\n    if (this.args.onClose && this.args.onClose(this.storedAPI, e) === false) {\n      return false;\n    }\n    this._highlight(undefined);\n  }\n\n  @action\n  handleInput(e: InputEvent): void {\n    if (e.target === null) return;\n    const term = (e.target as HTMLInputElement).value;\n    let correctedTerm;\n    if (this.args.onInput) {\n      correctedTerm = this.args.onInput(term, this.storedAPI, e);\n      if (correctedTerm === false) {\n        return;\n      }\n    }\n    this._publicAPIActions.search(\n      typeof correctedTerm === 'string' ? correctedTerm : term,\n    );\n  }\n\n  @action\n  handleKeydown(e: KeyboardEvent) {\n    if (\n      this.args.onKeydown &&\n      this.args.onKeydown(this.storedAPI, e) === false\n    ) {\n      return false;\n    }\n\n    if (this.args.multiple && e.keyCode === 13 && this.storedAPI.isOpen) {\n      e.stopPropagation();\n      if (this.storedAPI.highlighted !== undefined) {\n        if (\n          !this.storedAPI.selected ||\n          this.storedAPI.selected.indexOf(this.storedAPI.highlighted) === -1\n        ) {\n          this.storedAPI.actions.choose(this.storedAPI.highlighted, e);\n          return false;\n        } else {\n          this.storedAPI.actions.close(e);\n          return false;\n        }\n      } else {\n        this.storedAPI.actions.close(e);\n        return false;\n      }\n    }\n\n    if (\n      this.searchFieldPosition === 'trigger' &&\n      !this.storedAPI.isOpen &&\n      e.keyCode !== 9 && // TAB\n      e.keyCode !== 13 && // ENTER\n      e.keyCode !== 27 // ESC\n    ) {\n      this.storedAPI.actions.open(e);\n    }\n    return this._routeKeydown(this.storedAPI, e);\n  }\n\n  @action\n  handleTriggerKeydown(e: KeyboardEvent) {\n    if (\n      this.args.onKeydown &&\n      this.args.onKeydown(this.storedAPI, e) === false\n    ) {\n      e.stopImmediatePropagation();\n      return;\n    }\n    if (e.ctrlKey || e.metaKey) {\n      e.stopImmediatePropagation();\n      return;\n    }\n    if ((e.keyCode >= 48 && e.keyCode <= 90) || isNumpadKeyEvent(e)) {\n      // Keys 0-9, a-z or numpad keys\n      this.triggerTypingTask.perform(e);\n    } else if (e.keyCode === 32) {\n      // Space\n      this._handleKeySpace(this.storedAPI, e);\n    } else {\n      return this._routeKeydown(this.storedAPI, e);\n    }\n  }\n\n  @action\n  _labelClick(event: MouseEvent) {\n    if (!this.storedAPI) {\n      return;\n    }\n\n    // Double-click, do nothing\n    if (event.detail > 1) {\n      return;\n    }\n\n    if (this.labelClickAction === 'open') {\n      this.storedAPI.actions.open();\n      return;\n    } else if (this.labelClickAction === 'focus') {\n      const trigger = this.storedAPI.actions.getTriggerElement();\n\n      if (!trigger) {\n        return;\n      }\n\n      trigger.focus();\n    }\n\n    return true;\n  }\n\n  @action\n  handleFocus(event: FocusEvent): void {\n    if (!this.isDestroying) {\n      Promise.resolve().then(() => {\n        this._updateIsActive(true);\n      });\n    }\n    if (this.searchFieldPosition === 'trigger') {\n      if (event.target) {\n        const target = event.target as HTMLElement;\n        const input = target.querySelector(\n          'input[type=\"search\"]',\n        ) as HTMLInputElement | null;\n        input?.focus();\n      }\n    }\n    if (this.args.onFocus) {\n      this.args.onFocus(this.storedAPI, event);\n    }\n  }\n\n  @action\n  handleBlur(event: FocusEvent): void {\n    if (!this.isDestroying) {\n      Promise.resolve().then(() => {\n        this._updateIsActive(false);\n      });\n    }\n    if (this.args.onBlur) {\n      this.args.onBlur(this.storedAPI, event);\n    }\n  }\n\n  // Methods\n  @action\n  _search(term: string): void {\n    if (this.searchText === term) return;\n    this.searchText = term;\n    if (!this.args.search) {\n      this.lastSearchedText = term;\n      this._resetHighlighted();\n    }\n  }\n\n  @action\n  _updateOptions(): void {\n    deprecate(\n      'You are using power-select with ember/render-modifier. Replace {{did-insert this._updateOptions @options}} and {{did-update this._updateOptions @options}} with {{this.updateOptions @options}}.',\n      false,\n      {\n        for: 'ember-power-select',\n        id: 'ember-power-select.no-at-ember-render-modifiers',\n        since: {\n          enabled: '8.1',\n          available: '8.1',\n        },\n        until: '9.0.0',\n      },\n    );\n\n    this.__updateOptions();\n  }\n\n  @action\n  _updateHighlighted(): void {\n    if (this.storedAPI.isOpen) {\n      this._resetHighlighted();\n    }\n  }\n\n  @action\n  _updateSelected(): void {\n    deprecate(\n      'You are using power-select with ember/render-modifier. Replace {{did-insert this._updateSelected @selected}} and {{did-update this._updateSelected @selected}} with {{this.updateSelected @selected}}.',\n      false,\n      {\n        for: 'ember-power-select',\n        id: 'ember-power-select.no-at-ember-render-modifiers',\n        since: {\n          enabled: '8.1',\n          available: '8.1',\n        },\n        until: '9.0.0',\n      },\n    );\n\n    this.__updateSelected();\n  }\n\n  _selectedObserverCallback(): void {\n    this._resolvedSelected = this._lastSelectedPromise;\n    this._highlight(this._resolvedSelected);\n  }\n\n  @action\n  _highlight(opt: any): void {\n    if (!isNone(opt) && opt.disabled) {\n      return;\n    }\n    this.highlighted = opt;\n  }\n\n  @action\n  _select(selected: any, e?: Event): void {\n    if (!isEqual(this.storedAPI.selected, selected)) {\n      this.args.onChange(selected, this.storedAPI, e);\n    }\n  }\n\n  @action\n  _choose(selected: any, e?: Event): void {\n    const buildSelection = this.buildSelection;\n    const selection = buildSelection\n      ? buildSelection(selected, this.storedAPI)\n      : selected;\n    this.storedAPI.actions.select(selection, e);\n    if (this.args.closeOnSelect !== false) {\n      this.storedAPI.actions.close(e);\n      if (this.searchFieldPosition === 'trigger') {\n        this.searchText = '';\n      }\n      // return false;\n    }\n  }\n\n  @action\n  _scrollTo(option: any): void {\n    const select = this.storedAPI;\n    if (!document || !option) {\n      return;\n    }\n    if (this.args.scrollTo) {\n      return this.args.scrollTo(option, select);\n    }\n\n    let root: Document | HTMLElement;\n\n    const triggerElement = select.actions.getTriggerElement();\n    if (triggerElement && triggerElement.getRootNode() instanceof ShadowRoot) {\n      root = triggerElement.getRootNode() as HTMLElement;\n    } else {\n      root = document;\n    }\n\n    const optionsList = root.querySelector(\n      `#ember-power-select-options-${select.uniqueId}`,\n    ) as HTMLElement;\n    if (!optionsList) {\n      return;\n    }\n    const index = indexOfOption(select.results, option);\n    if (index === -1) {\n      return;\n    }\n    const optionElement = optionsList.querySelector(\n      `[data-option-index='${index}']`,\n    ) as HTMLElement;\n    if (!optionElement) {\n      return;\n    }\n    const optionTopScroll = optionElement.offsetTop - optionsList.offsetTop;\n    const optionBottomScroll = optionTopScroll + optionElement.offsetHeight;\n    if (optionBottomScroll > optionsList.offsetHeight + optionsList.scrollTop) {\n      optionsList.scrollTop = optionBottomScroll - optionsList.offsetHeight;\n    } else if (optionTopScroll < optionsList.scrollTop) {\n      optionsList.scrollTop = optionTopScroll;\n    }\n  }\n\n  @action\n  _registerAPI(triggerElement: Element, [publicAPI]: [Select]): void {\n    deprecate(\n      'You are using power-select with ember/render-modifier. Replace {{did-insert this._registerAPI publicAPI}} and {{did-update this._registerAPI publicAPI}} with {{this.updateRegisterAPI publicAPI}}.',\n      false,\n      {\n        for: 'ember-power-select',\n        id: 'ember-power-select.no-at-ember-render-modifiers',\n        since: {\n          enabled: '8.1',\n          available: '8.1',\n        },\n        until: '9.0.0',\n      },\n    );\n\n    this.__registerAPI(triggerElement, [publicAPI]);\n  }\n\n  @action\n  _performSearch(triggerElement: Element, [term]: [string]): void {\n    deprecate(\n      'You are using power-select with ember/render-modifier. Replace {{did-update this._performSearch this.searchText}} with {{this.updatePerformSearch this.searchText}}.',\n      false,\n      {\n        for: 'ember-power-select',\n        id: 'ember-power-select.no-at-ember-render-modifiers',\n        since: {\n          enabled: '8.1',\n          available: '8.1',\n        },\n        until: '9.0.0',\n      },\n    );\n\n    this.__performSearch(triggerElement, [term]);\n  }\n\n  updateOptions = modifier(\n    () => {\n      this.__updateOptions();\n    },\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    { eager: false },\n  );\n\n  updateSelected = modifier(\n    () => {\n      this.__updateSelected();\n    },\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    { eager: false },\n  );\n\n  updateRegisterAPI = modifier(\n    (triggerElement: Element, [publicAPI]: [Select]) => {\n      this.__registerAPI(triggerElement, [publicAPI]);\n    },\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    { eager: false },\n  );\n\n  updatePerformSearch = modifier(\n    (triggerElement: Element, [term]: [string]) => {\n      this.__performSearch(triggerElement, [term]);\n    },\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    { eager: false },\n  );\n\n  private __updateOptions() {\n    if (!this.args.options) return;\n    if (isPromiseLike(this.args.options)) {\n      if (this._lastOptionsPromise === this.args.options) return; // promise is still the same\n      const currentOptionsPromise = this.args.options;\n      this._lastOptionsPromise = currentOptionsPromise;\n      this.loading = true;\n      this._lastOptionsPromise\n        .then((resolvedOptions) => {\n          if (this._lastOptionsPromise === currentOptionsPromise) {\n            this.loading = false;\n            this._resolvedOptions = resolvedOptions;\n            this._resetHighlighted();\n          }\n        })\n        .catch(() => {\n          if (this._lastOptionsPromise === currentOptionsPromise) {\n            this.loading = false;\n          }\n        });\n    } else {\n      Promise.resolve().then(() => {\n        this._resetHighlighted();\n      });\n    }\n  }\n\n  private __updateSelected(): void {\n    if (isNone(this.args.selected)) return;\n    if (typeof this.args.selected.then === 'function') {\n      if (this._lastSelectedPromise === this.args.selected) return; // promise is still the same\n      if (\n        this._lastSelectedPromise &&\n        isPromiseProxyLike(this._lastSelectedPromise)\n      ) {\n        removeObserver(\n          this._lastSelectedPromise,\n          'content',\n          this,\n          this._selectedObserverCallback,\n        );\n      }\n\n      const currentSelectedPromise: PromiseProxy<any> = this.args.selected;\n      currentSelectedPromise.then(() => {\n        if (this.isDestroyed || this.isDestroying) return;\n        if (isPromiseProxyLike(currentSelectedPromise)) {\n          // eslint-disable-next-line ember/no-observers\n          addObserver(\n            currentSelectedPromise,\n            'content',\n            this,\n            this._selectedObserverCallback,\n          );\n        }\n      });\n\n      this._lastSelectedPromise = currentSelectedPromise;\n      this._lastSelectedPromise.then((resolvedSelected) => {\n        if (this._lastSelectedPromise === currentSelectedPromise) {\n          this._resolvedSelected = resolvedSelected;\n          this._highlight(resolvedSelected);\n        }\n      });\n    } else {\n      this._resolvedSelected = undefined;\n      // Don't highlight args.selected array on multi-select\n      if (!Array.isArray(this.args.selected)) {\n        this._highlight(this.args.selected);\n      }\n    }\n  }\n\n  private __registerAPI(_: Element, [publicAPI]: [Select]): void {\n    this.storedAPI = publicAPI;\n    if (this.args.registerAPI) {\n      Promise.resolve().then(() => {\n        if (this.args.registerAPI) {\n          this.args.registerAPI(publicAPI);\n        }\n      });\n    }\n  }\n\n  private __performSearch(_: Element, [term]: [string]): void {\n    if (!this.args.search) return;\n    if (term === '') {\n      this.loading = false;\n      this.lastSearchedText = term;\n      if (this._lastSearchPromise !== undefined) {\n        if (isCancellablePromise(this._lastSearchPromise)) {\n          this._lastSearchPromise.cancel(); // Cancel ember-concurrency tasks\n        }\n        this._lastSearchPromise = undefined;\n      }\n      return;\n    }\n    const searchResult = this.args.search(term, this.storedAPI);\n    if (searchResult && isPromiseLike(searchResult)) {\n      this.loading = true;\n      if (\n        this._lastSearchPromise !== undefined &&\n        isCancellablePromise(this._lastSearchPromise)\n      ) {\n        this._lastSearchPromise.cancel(); // Cancel ember-concurrency tasks\n      }\n      this._lastSearchPromise = searchResult;\n      searchResult\n        .then((results) => {\n          if (this._lastSearchPromise === searchResult) {\n            this._searchResult = results;\n            this.loading = false;\n            this.lastSearchedText = term;\n            Promise.resolve().then(() => {\n              this._resetHighlighted();\n            });\n          }\n        })\n        .catch(() => {\n          if (this._lastSearchPromise === searchResult) {\n            this.loading = false;\n            this.lastSearchedText = term;\n          }\n        });\n    } else {\n      this.lastSearchedText = term;\n      this._searchResult = searchResult;\n      Promise.resolve().then(() => {\n        this._resetHighlighted();\n      });\n    }\n  }\n\n  _defaultBuildSelection(option: any): any {\n    return option;\n  }\n\n  @action\n  private _defaultMultipleBuildSelection(option: any, select: Select): any[] {\n    if (!this.args.multiple) {\n      throw new Error(\n        'The _defaultMultipleBuildSelection is only allowed for multiple',\n      );\n    }\n\n    const newSelection = Array.isArray(select.selected)\n      ? select.selected.slice(0)\n      : [];\n    let idx = -1;\n    for (let i = 0; i < newSelection.length; i++) {\n      if (isEqual(newSelection[i], option)) {\n        idx = i;\n        break;\n      }\n    }\n    if (idx > -1) {\n      newSelection.splice(idx, 1);\n    } else {\n      newSelection.push(option);\n    }\n    return newSelection;\n  }\n\n  focusInput(select: Select) {\n    if (select) {\n      const triggerElement = select.actions.getTriggerElement();\n      let root: Document | HTMLElement;\n\n      if (\n        triggerElement &&\n        triggerElement.getRootNode() instanceof ShadowRoot\n      ) {\n        root = triggerElement.getRootNode() as HTMLElement;\n      } else {\n        root = document;\n      }\n\n      const input = root.querySelector(\n        `#ember-power-select-trigger-input-${select.uniqueId}`,\n      ) as HTMLElement;\n\n      if (input) {\n        input.focus();\n      }\n    }\n  }\n\n  _routeKeydown(select: Select, e: KeyboardEvent): boolean | void {\n    if (e.keyCode === 38 || e.keyCode === 40) {\n      // Up & Down\n      return this._handleKeyUpDown(select, e);\n    } else if (e.keyCode === 13) {\n      // ENTER\n      return this._handleKeyEnter(select, e);\n    } else if (e.keyCode === 9) {\n      // Tab\n      return this._handleKeyTab(select, e);\n    } else if (e.keyCode === 27) {\n      // ESC\n      return this._handleKeyESC(select, e);\n    }\n  }\n\n  _handleKeyTab(select: Select, e: KeyboardEvent): void {\n    select.actions.close(e);\n  }\n\n  _handleKeyESC(select: Select, e: KeyboardEvent): void {\n    select.actions.close(e);\n  }\n\n  _handleKeyEnter(select: Select, e: KeyboardEvent): boolean | void {\n    if (select.isOpen && select.highlighted !== undefined) {\n      select.actions.choose(select.highlighted, e);\n      e.stopImmediatePropagation();\n      return false;\n    }\n  }\n\n  _handleKeySpace(select: Select, e: KeyboardEvent): void {\n    if (\n      e.target !== null &&\n      ['TEXTAREA', 'INPUT'].includes((e.target as Element).nodeName)\n    ) {\n      e.stopImmediatePropagation();\n    } else if (select.isOpen && select.highlighted !== undefined) {\n      e.stopImmediatePropagation();\n      e.preventDefault(); // Prevents scrolling of the page.\n      select.actions.choose(select.highlighted, e);\n    }\n  }\n\n  _handleKeyUpDown(select: Select, e: KeyboardEvent): void {\n    if (select.isOpen) {\n      e.preventDefault();\n      e.stopPropagation();\n      const step: 1 | -1 = e.keyCode === 40 ? 1 : -1;\n      const newHighlighted = advanceSelectableOption(\n        select.results,\n        select.highlighted,\n        step,\n      );\n      select.actions.highlight(newHighlighted);\n      select.actions.scrollTo(newHighlighted);\n    } else {\n      select.actions.open(e);\n    }\n  }\n\n  _resetHighlighted(): void {\n    let highlighted;\n    const defHighlighted = this.args.defaultHighlighted || defaultHighlighted;\n    if (typeof defHighlighted === 'function') {\n      highlighted = defHighlighted({\n        results: this.results,\n        highlighted: this.highlighted,\n        selected: this.selected,\n      });\n    } else {\n      highlighted = defHighlighted;\n    }\n    this._highlight(highlighted);\n  }\n\n  _filter(options: any[], term: string, skipDisabled = false): any[] {\n    const matcher = this.args.matcher || defaultMatcher;\n    const optionMatcher = getOptionMatcher(\n      matcher,\n      defaultMatcher,\n      this.args.searchField,\n    );\n    return filterOptions(options || [], term, optionMatcher, skipDisabled);\n  }\n\n  _updateIsActive(value: boolean) {\n    this.isActive = value;\n  }\n\n  findWithOffset(\n    options: readonly any[],\n    term: string,\n    offset: number,\n    skipDisabled = false,\n  ): any {\n    const typeAheadOptionMatcher = getOptionMatcher(\n      this.args.typeAheadOptionMatcher || defaultTypeAheadMatcher,\n      defaultTypeAheadMatcher,\n      this.args.searchField,\n    );\n    return findOptionWithOffset(\n      options || [],\n      term,\n      typeAheadOptionMatcher,\n      offset,\n      skipDisabled,\n    );\n  }\n\n  // Tasks\n  triggerTypingTask = restartableTask(async (e: KeyboardEvent) => {\n    // In general, a user doing this interaction means to have a different result.\n    let searchStartOffset = 1;\n    let repeatingChar = this._repeatingChar;\n    let charCode = e.keyCode;\n    if (isNumpadKeyEvent(e)) {\n      charCode -= 48; // Adjust char code offset for Numpad key codes. Check here for numapd key code behavior: https://goo.gl/Qwc9u4\n    }\n    let term;\n\n    // Check if user intends to cycle through results. _repeatingChar can only be the first character.\n    const c = String.fromCharCode(charCode);\n    if (c === this._repeatingChar) {\n      term = c;\n    } else {\n      term = this._expirableSearchText + c;\n    }\n\n    if (term.length > 1) {\n      // If the term is longer than one char, the user is in the middle of a non-cycling interaction\n      // so the offset is just zero (the current selection is a valid match).\n      searchStartOffset = 0;\n      repeatingChar = '';\n    } else {\n      repeatingChar = c;\n    }\n\n    // When the select is open, the \"selection\" is just highlighted.\n    if (this.storedAPI.isOpen && this.storedAPI.highlighted) {\n      searchStartOffset += indexOfOption(\n        this.storedAPI.options,\n        this.storedAPI.highlighted,\n      );\n    } else if (!this.storedAPI.isOpen && !isNone(this.selected)) {\n      searchStartOffset += indexOfOption(this.storedAPI.options, this.selected);\n    } else {\n      searchStartOffset = 0;\n    }\n\n    // The char is always appended. That way, searching for words like \"Aaron\" will work even\n    // if \"Aa\" would cycle through the results.\n    this._expirableSearchText = this._expirableSearchText + c;\n    this._repeatingChar = repeatingChar;\n    const match = this.findWithOffset(\n      this.storedAPI.options,\n      term,\n      searchStartOffset,\n      true,\n    );\n    if (match !== undefined) {\n      if (this.storedAPI.isOpen) {\n        this.storedAPI.actions.highlight(match);\n        this.storedAPI.actions.scrollTo(match);\n      } else {\n        this.storedAPI.actions.select(match, e);\n      }\n    }\n    await timeout(1000);\n    this._expirableSearchText = '';\n    this._repeatingChar = '';\n  });\n}\n\nfunction getOptionMatcher(\n  matcher: MatcherFn,\n  defaultMatcher: MatcherFn,\n  searchField: string | undefined,\n): MatcherFn {\n  if (searchField && matcher === defaultMatcher) {\n    return (option: any, text: string) =>\n      matcher(get(option, searchField), text);\n  } else {\n    return (option: any, text: string) => {\n      assert(\n        '<PowerSelect> If you want the default filtering to work on options that are not plain strings, you need to provide `@searchField`',\n        matcher !== defaultMatcher || typeof option === 'string',\n      );\n      return matcher(option, text);\n    };\n  }\n}\n\nfunction isNumpadKeyEvent(e: KeyboardEvent): boolean {\n  return e.keyCode >= 96 && e.keyCode <= 105;\n}\n\nconst toPlainArray = <T>(collection: T[] | Sliceable<T>): T[] => {\n  if (isSliceable<T>(collection)) {\n    return collection.slice();\n  } else {\n    return collection;\n  }\n};\n"],"names":["isSliceable","coll","isArray","isPromiseLike","thing","then","isPromiseProxyLike","Object","hasOwnProperty","call","isCancellablePromise","cancel","PowerSelectComponent","Component","_publicAPIActions","search","_search","highlight","_highlight","select","_select","choose","_choose","scrollTo","_scrollTo","labelClick","_labelClick","g","prototype","tracked","i","void 0","storedAPI","_uid","guidFor","_lastOptionsPromise","_lastSelectedPromise","_lastSearchPromise","_filterResultsCache","results","options","searchText","constructor","owner","args","assert","onChange","willDestroy","removeObserver","_selectedObserverCallback","undefined","highlightOnHover","labelClickAction","highlightedIndex","highlighted","pathForOption","searchMessage","noMatchesMessage","resultCountMessage","resultsCount","matchTriggerWidth","mustShowSearchMessage","loading","length","mustShowNoMessages","lastSearchedText","toPlainArray","_searchResult","_filter","_resolvedOptions","countOptions","selected","_resolvedSelected","isNone","ariaMultiSelectable","triggerId","labelId","ariaLabelledBy","labelText","labelComponent","searchFieldPosition","multiple","tabindex","triggerComponent","searchEnabled","buildSelection","_defaultMultipleBuildSelection","handleOpen","e","onOpen","focusInput","KeyboardEvent","type","keyCode","preventDefault","_resetHighlighted","n","action","handleClose","onClose","handleInput","target","term","value","correctedTerm","onInput","handleKeydown","onKeydown","isOpen","stopPropagation","indexOf","actions","close","open","_routeKeydown","handleTriggerKeydown","stopImmediatePropagation","ctrlKey","metaKey","isNumpadKeyEvent","triggerTypingTask","perform","_handleKeySpace","event","detail","trigger","getTriggerElement","focus","handleFocus","isDestroying","Promise","resolve","_updateIsActive","input","querySelector","onFocus","handleBlur","onBlur","_updateOptions","deprecate","for","id","since","enabled","available","until","__updateOptions","_updateHighlighted","_updateSelected","__updateSelected","opt","disabled","isEqual","selection","closeOnSelect","option","document","root","triggerElement","getRootNode","ShadowRoot","optionsList","uniqueId","index","indexOfOption","optionElement","optionTopScroll","offsetTop","optionBottomScroll","offsetHeight","scrollTop","_registerAPI","publicAPI","__registerAPI","_performSearch","__performSearch","updateOptions","modifier","eager","updateSelected","updateRegisterAPI","updatePerformSearch","currentOptionsPromise","resolvedOptions","catch","currentSelectedPromise","isDestroyed","addObserver","resolvedSelected","Array","_","registerAPI","searchResult","_defaultBuildSelection","Error","newSelection","slice","idx","splice","push","_handleKeyUpDown","_handleKeyEnter","_handleKeyTab","_handleKeyESC","includes","nodeName","step","newHighlighted","advanceSelectableOption","defHighlighted","defaultHighlighted","skipDisabled","matcher","defaultMatcher","optionMatcher","getOptionMatcher","searchField","filterOptions","isActive","findWithOffset","offset","typeAheadOptionMatcher","defaultTypeAheadMatcher","findOptionWithOffset","_buildTask","context","generator","searchStartOffset","repeatingChar","_repeatingChar","charCode","c","String","fromCharCode","_expirableSearchText","match","timeout","text","get","collection","setComponentTemplate","TEMPLATE"],"mappings":"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"}