{"version":3,"file":"trigger.js","sources":["../../../src/components/power-select/trigger.gts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { action } from '@ember/object';\nimport { get } from '@ember/object';\nimport { modifier } from 'ember-modifier';\nimport PowerSelectInput, { type PowerSelectInputSignature } from './input.gts';\nimport { and, eq, isEmpty, not, notEq, or } from 'ember-truth-helpers';\nimport { on } from '@ember/modifier';\nimport selectIsSelectedPresent from '../../helpers/ember-power-select-is-selected-present.ts';\nimport type { PowerSelectArgs } from '../power-select.gts';\nimport type { ComponentLike } from '@glint/template';\nimport type { PowerSelectPlaceholderSignature } from './placeholder.gts';\nimport type {\n  Option,\n  PowerSelectSelectedItemSignature,\n  Select,\n  Selected,\n  TSearchFieldPosition,\n} from '../../types.ts';\n\nexport interface PowerSelectTriggerSignature<\n  T = unknown,\n  TExtra = unknown,\n  IsMultiple extends boolean = false,\n> {\n  Element: HTMLUListElement;\n  Args: {\n    select: Select<T, IsMultiple>;\n    allowClear?: boolean;\n    searchEnabled?: boolean;\n    placeholder?: string;\n    searchPlaceholder?: string;\n    searchField?: string;\n    searchFieldPosition?: TSearchFieldPosition;\n    listboxId?: string;\n    tabindex?: number | string;\n    ariaLabel?: string;\n    ariaLabelledBy?: string;\n    ariaDescribedBy?: string;\n    loadingMessage?: string;\n    role?: string;\n    ariaActiveDescendant: string;\n    extra?: TExtra;\n    buildSelection?: PowerSelectArgs<T, IsMultiple, TExtra>['buildSelection'];\n    placeholderComponent?: ComponentLike<\n      PowerSelectPlaceholderSignature<T, TExtra, IsMultiple>\n    >;\n    selectedItemComponent?: ComponentLike<\n      PowerSelectSelectedItemSignature<T, TExtra, IsMultiple>\n    >;\n    onInput?: (e: InputEvent) => void | boolean;\n    onKeydown?: (e: KeyboardEvent) => void | boolean;\n    onFocus?: (e: FocusEvent) => void;\n    onBlur?: (e: FocusEvent) => void;\n  };\n  Blocks: {\n    default: [selected: Option<T>, select: Select<T, IsMultiple>];\n  };\n}\n\nexport default class PowerSelectTriggerComponent<\n  T = unknown,\n  TExtra = unknown,\n  IsMultiple extends boolean = false,\n> extends Component<PowerSelectTriggerSignature<T, TExtra, IsMultiple>> {\n  private _lastIsOpen: boolean = this.args.select.isOpen;\n\n  get inputComponent(): ComponentLike<\n    PowerSelectInputSignature<T, TExtra, IsMultiple>\n  > {\n    return PowerSelectInput as ComponentLike<\n      PowerSelectInputSignature<T, TExtra, IsMultiple>\n    >;\n  }\n\n  get selected() {\n    return this.args.select.selected as Selected<T, false>;\n  }\n\n  get selectedMultiple() {\n    return this.args.select.selected as Selected<T, true>;\n  }\n\n  @action\n  clear(e: Event): false | void {\n    e.stopPropagation();\n    const value = this.args.select.multiple ? [] : undefined;\n    this.args.select.actions.select(value as Selected<T, IsMultiple>);\n    if (e.type === 'touchstart') {\n      return false;\n    }\n  }\n\n  isOptionDisabled(option: Option<T>): boolean {\n    if (option && typeof option === 'object' && 'disabled' in option) {\n      return option.disabled as boolean;\n    }\n\n    return false;\n  }\n\n  @action\n  chooseOption(e: Event) {\n    if (!this.args.select.multiple) {\n      return;\n    }\n\n    if (e.target === null) return;\n    const selectedIndex = (e.target as Element).getAttribute(\n      'data-selected-index',\n    );\n    if (selectedIndex) {\n      const numericIndex = parseInt(selectedIndex, 10);\n      e.stopPropagation();\n      e.preventDefault();\n      const object = this.selectedObject(this.selectedMultiple, numericIndex);\n      this.args.select.actions.choose(object);\n    }\n  }\n\n  openChange = modifier((element: Element, [isOpen]: [boolean]) => {\n    this._openChanged(element, [isOpen]);\n  });\n\n  private _openChanged(_el: Element, [isOpen]: [boolean]) {\n    if (isOpen === false && this._lastIsOpen === true) {\n      void Promise.resolve().then(() => {\n        this.args.select.actions?.search('');\n      });\n    }\n    this._lastIsOpen = isOpen;\n  }\n\n  selectedObject<T>(\n    list: readonly Option<T>[] | undefined,\n    index: number,\n  ): Option<T> | undefined {\n    if (list && 'objectAt' in list && typeof list.objectAt === 'function') {\n      return (\n        list as readonly Option<T>[] & {\n          objectAt(index: number): T | undefined;\n        }\n      ).objectAt(index) as Option<T> | undefined;\n    } else if (list) {\n      return get(list, index);\n    }\n  }\n\n  <template>\n    {{#if @select.multiple}}\n      {{! template-lint-disable no-invalid-interactive }}\n      {{! template-lint-disable no-pointer-down-event-binding }}\n      {{! template-lint-disable no-unsupported-role-attributes }}\n      {{! template-lint-disable require-aria-activedescendant-tabindex }}\n      <ul\n        id=\"ember-power-select-multiple-options-{{@select.uniqueId}}\"\n        aria-activedescendant={{if\n          (and @select.isOpen (not @searchEnabled))\n          @ariaActiveDescendant\n        }}\n        class=\"ember-power-select-multiple-options\"\n        {{this.openChange @select.isOpen}}\n        {{on \"touchstart\" this.chooseOption}}\n        {{on \"mousedown\" this.chooseOption}}\n        ...attributes\n      >\n        {{#if (selectIsSelectedPresent this.selectedMultiple)}}\n          {{#each this.selectedMultiple as |opt idx|}}\n            <li\n              class=\"ember-power-select-multiple-option\n                {{if\n                  (this.isOptionDisabled opt)\n                  'ember-power-select-multiple-option--disabled'\n                }}\"\n            >\n              {{#unless @select.disabled}}\n                <span\n                  role=\"button\"\n                  aria-label=\"remove element\"\n                  class=\"ember-power-select-multiple-remove-btn\"\n                  data-selected-index={{idx}}\n                >\n                  &times;\n                </span>\n              {{/unless}}\n              {{#if @selectedItemComponent}}\n                {{#let @selectedItemComponent as |SelectedItemComponent|}}\n                  <SelectedItemComponent\n                    @extra={{@extra}}\n                    @selected={{opt}}\n                    @select={{@select}}\n                  />\n                {{/let}}\n              {{else}}\n                {{yield opt @select}}\n              {{/if}}\n            </li>\n          {{/each}}\n        {{else}}\n          {{#if\n            (and\n              @placeholder\n              (or\n                (not @searchEnabled) (eq @searchFieldPosition \"before-options\")\n              )\n            )\n          }}\n            <li>\n              {{#let @placeholderComponent as |PlaceholderComponent|}}\n                <PlaceholderComponent\n                  @placeholder={{@placeholder}}\n                  @select={{@select}}\n                />\n              {{/let}}\n            </li>\n          {{/if}}\n        {{/if}}\n        {{#if (and @searchEnabled (eq @searchFieldPosition \"trigger\"))}}\n          <li class=\"ember-power-select-trigger-multiple-input-container\">\n            {{#let\n              (component\n                this.inputComponent\n                select=@select\n                extra=@extra\n                ariaActiveDescendant=@ariaActiveDescendant\n                ariaLabelledBy=@ariaLabelledBy\n                ariaDescribedBy=@ariaDescribedBy\n                role=@role\n                ariaLabel=@ariaLabel\n                listboxId=@listboxId\n                tabindex=@tabindex\n                buildSelection=@buildSelection\n                searchPlaceholder=(or @placeholder @searchPlaceholder)\n                placeholderComponent=@placeholderComponent\n                searchField=@searchField\n                searchFieldPosition=@searchFieldPosition\n                onFocus=@onFocus\n                onBlur=@onBlur\n                onKeydown=@onKeydown\n                onInput=@onInput\n              )\n              as |InputComponent|\n            }}\n              {{#let @placeholderComponent as |PlaceholderComponent|}}\n                <PlaceholderComponent\n                  @select={{@select}}\n                  @extra={{@extra}}\n                  @placeholder={{@placeholder}}\n                  @isMultipleWithSearch={{true}}\n                  @inputComponent={{InputComponent}}\n                  @displayPlaceholder={{and\n                    (not @select.searchText)\n                    (isEmpty @select.selected)\n                  }}\n                />\n              {{/let}}\n            {{/let}}\n          </li>\n        {{/if}}\n      </ul>\n    {{else}}\n      {{#if (selectIsSelectedPresent this.selected)}}\n        {{#if\n          (or (notEq @searchFieldPosition \"trigger\") (not @select.searchText))\n        }}\n          {{#if @selectedItemComponent}}\n            {{#let @selectedItemComponent as |SelectedItemComponent|}}\n              <SelectedItemComponent\n                @extra={{@extra}}\n                @selected={{this.selected}}\n                @select={{@select}}\n              />\n            {{/let}}\n          {{else}}\n            <span class=\"ember-power-select-selected-item\">\n              {{yield this.selected @select}}\n            </span>\n          {{/if}}\n        {{/if}}\n        {{#if (and @searchEnabled (eq @searchFieldPosition \"trigger\"))}}\n          <PowerSelectInput\n            @select={{@select}}\n            @extra={{@extra}}\n            @ariaActiveDescendant={{@ariaActiveDescendant}}\n            @ariaLabelledBy={{@ariaLabelledBy}}\n            @ariaDescribedBy={{@ariaDescribedBy}}\n            @role={{@role}}\n            @ariaLabel={{@ariaLabel}}\n            @listboxId={{@listboxId}}\n            @tabindex={{@tabindex}}\n            @buildSelection={{@buildSelection}}\n            @searchPlaceholder={{or @placeholder @searchPlaceholder}}\n            @placeholderComponent={{@placeholderComponent}}\n            @searchField={{@searchField}}\n            @onFocus={{@onFocus}}\n            @onBlur={{@onBlur}}\n            @onKeydown={{@onKeydown}}\n            @onInput={{@onInput}}\n            @searchFieldPosition={{@searchFieldPosition}}\n            @autofocus={{false}}\n          />\n        {{/if}}\n        {{#if (and @allowClear (not @select.disabled))}}\n          {{! template-lint-disable no-pointer-down-event-binding }}\n          <span\n            class=\"ember-power-select-clear-btn\"\n            role=\"button\"\n            {{on \"mousedown\" this.clear}}\n            {{on \"touchstart\" this.clear}}\n          >&times;</span>\n        {{/if}}\n      {{else}}\n        {{#if (and @searchEnabled (eq @searchFieldPosition \"trigger\"))}}\n          {{#let\n            (component\n              this.inputComponent\n              select=@select\n              extra=@extra\n              ariaActiveDescendant=@ariaActiveDescendant\n              ariaLabelledBy=@ariaLabelledBy\n              ariaDescribedBy=@ariaDescribedBy\n              role=@role\n              ariaLabel=@ariaLabel\n              listboxId=@listboxId\n              searchPlaceholder=(or @placeholder @searchPlaceholder)\n              onFocus=@onFocus\n              onBlur=@onBlur\n              onKeydown=@onKeydown\n              onInput=@onInput\n              searchFieldPosition=@searchFieldPosition\n              autofocus=false\n            )\n            as |InputComponent|\n          }}\n            {{#let @placeholderComponent as |PlaceholderComponent|}}\n              <PlaceholderComponent\n                @select={{@select}}\n                @placeholder={{@placeholder}}\n                @isMultipleWithSearch={{true}}\n                @inputComponent={{InputComponent}}\n                @extra={{@extra}}\n                @displayPlaceholder={{and\n                  (not @select.searchText)\n                  (isEmpty this.selected)\n                }}\n              />\n            {{/let}}\n          {{/let}}\n        {{else}}\n          {{#let @placeholderComponent as |PlaceholderComponent|}}\n            <PlaceholderComponent\n              @placeholder={{@placeholder}}\n              @select={{@select}}\n              @extra={{@extra}}\n            />\n          {{/let}}\n        {{/if}}\n      {{/if}}\n    {{/if}}\n    <span class=\"ember-power-select-status-icon\"></span>\n  </template>\n}\n"],"names":["PowerSelectTriggerComponent","Component","_lastIsOpen","args","select","isOpen","inputComponent","PowerSelectInput","selected","selectedMultiple","clear","e","stopPropagation","value","multiple","undefined","actions","type","n","prototype","action","isOptionDisabled","option","disabled","chooseOption","target","selectedIndex","getAttribute","numericIndex","parseInt","preventDefault","object","selectedObject","choose","openChange","modifier","element","_openChanged","_el","Promise","resolve","then","search","list","index","objectAt","get","setComponentTemplate","precompileTemplate","strictMode","scope","and","not","on","selectIsSelectedPresent","or","eq","isEmpty","notEq"],"mappings":"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"}