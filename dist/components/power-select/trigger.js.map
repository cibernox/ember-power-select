{"version":3,"file":"trigger.js","sources":["../../../src/components/power-select/trigger.ts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { action } from '@ember/object';\nimport { get } from '@ember/object';\nimport { modifier } from 'ember-modifier';\nimport { deprecate } from '@ember/debug';\nimport type { Select, TSearchFieldPosition } from '../power-select';\nimport type { ComponentLike } from '@glint/template';\n\ninterface IndexAccesible<T> {\n  objectAt(index: number): T;\n}\n\nconst isIndexAccesible = <T>(target: any): target is IndexAccesible<T> => {\n  return typeof target.objectAt === 'function';\n};\n\ninterface PowerSelectTriggerSignature {\n  Element: HTMLElement;\n  Args: {\n    select: Select;\n    allowClear: boolean;\n    searchEnabled: boolean;\n    placeholder?: string;\n    searchPlaceholder?: string;\n    searchField: string;\n    searchFieldPosition?: TSearchFieldPosition;\n    listboxId?: string;\n    tabindex?: string;\n    ariaLabel?: string;\n    ariaLabelledBy?: string;\n    ariaDescribedBy?: string;\n    role?: string;\n    ariaActiveDescendant: string;\n    extra?: any;\n    placeholderComponent?: string | ComponentLike<any>;\n    selectedItemComponent?: string | ComponentLike<any>;\n    onInput?: (e: InputEvent) => boolean;\n    onKeydown?: (e: KeyboardEvent) => boolean;\n    onFocus?: (e: FocusEvent) => void;\n    onBlur?: (e: FocusEvent) => void;\n    buildSelection: (lastSelection: any, select: Select) => any[];\n  };\n  Blocks: {\n    default: [selected: any, select: Select];\n  };\n}\n\nexport default class PowerSelectTriggerComponent extends Component<PowerSelectTriggerSignature> {\n  private _lastIsOpen: boolean = this.args.select.isOpen;\n\n  @action\n  clear(e: Event): false | void {\n    e.stopPropagation();\n    this.args.select.actions.select(null);\n    if (e.type === 'touchstart') {\n      return false;\n    }\n  }\n\n  // Actions\n  @action\n  openChanged(element: Element, [isOpen]: [boolean]) {\n    deprecate(\n      'You are using a power-select-multiple trigger with ember/render-modifier. Replace {{did-update this.openChanged @select.isOpen}} with {{this.openChange @select.isOpen}}.',\n      false,\n      {\n        for: 'ember-power-select',\n        id: 'ember-power-select.no-at-ember-render-modifiers',\n        since: {\n          enabled: '8.1',\n          available: '8.1',\n        },\n        until: '9.0.0',\n      },\n    );\n\n    this._openChanged(element, [isOpen]);\n  }\n\n  @action\n  chooseOption(e: Event) {\n    if (e.target === null) return;\n    const selectedIndex = (e.target as Element).getAttribute(\n      'data-selected-index',\n    );\n    if (selectedIndex) {\n      const numericIndex = parseInt(selectedIndex, 10);\n      e.stopPropagation();\n      e.preventDefault();\n      const object = this.selectedObject(\n        this.args.select.selected,\n        numericIndex,\n      );\n      this.args.select.actions.choose(object);\n    }\n  }\n\n  openChange = modifier((element: Element, [isOpen]: [boolean]) => {\n    this._openChanged(element, [isOpen]);\n  });\n\n  private _openChanged(_el: Element, [isOpen]: [boolean]) {\n    if (isOpen === false && this._lastIsOpen === true) {\n      Promise.resolve().then(() => {\n        this.args.select.actions?.search('');\n      });\n    }\n    this._lastIsOpen = isOpen;\n  }\n\n  selectedObject<T>(list: IndexAccesible<T> | T[], index: number): T {\n    if (isIndexAccesible(list)) {\n      return list.objectAt(index);\n    } else {\n      return get(list, index) as T;\n    }\n  }\n}\n"],"names":["isIndexAccesible","target","objectAt","PowerSelectTriggerComponent","Component","_lastIsOpen","args","select","isOpen","clear","e","stopPropagation","actions","type","n","prototype","action","openChanged","element","deprecate","for","id","since","enabled","available","until","_openChanged","chooseOption","selectedIndex","getAttribute","numericIndex","parseInt","preventDefault","object","selectedObject","selected","choose","openChange","modifier","_el","Promise","resolve","then","search","list","index","get","setComponentTemplate","TEMPLATE"],"mappings":"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"}