{"version":3,"file":"before-options.js","sources":["../../../src/components/power-select/before-options.gts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { action } from '@ember/object';\nimport { modifier } from 'ember-modifier';\nimport { task, timeout } from 'ember-concurrency';\nimport { on } from '@ember/modifier';\nimport { and, eq, or } from 'ember-truth-helpers';\nimport type { ComponentLike } from '@glint/template';\nimport type { PowerSelectPlaceholderSignature } from './placeholder.gts';\nimport type {\n  PowerSelectSelectedItemSignature,\n  Select,\n  TSearchFieldPosition,\n} from '../../types';\n\nexport interface PowerSelectBeforeOptionsSignature<\n  T = unknown,\n  TExtra = unknown,\n  IsMultiple extends boolean = false,\n> {\n  Element: HTMLDivElement;\n  Args: {\n    select: Select<T, IsMultiple>;\n    searchEnabled?: boolean;\n    ariaLabel?: string;\n    ariaLabelledBy?: string;\n    ariaDescribedBy?: string;\n    role?: string;\n    searchPlaceholder?: string;\n    searchFieldPosition?: TSearchFieldPosition;\n    ariaActiveDescendant?: string;\n    listboxId?: string;\n    placeholder?: string;\n    autofocus?: boolean;\n    extra?: TExtra;\n    triggerRole?: string;\n    onKeydown: (e: KeyboardEvent) => boolean | void;\n    onBlur: (e: FocusEvent) => void;\n    onFocus: (e: FocusEvent) => void;\n    onInput: (e: InputEvent) => boolean | void;\n    placeholderComponent?: ComponentLike<\n      PowerSelectPlaceholderSignature<T, TExtra, IsMultiple>\n    >;\n    selectedItemComponent?: ComponentLike<\n      PowerSelectSelectedItemSignature<T, TExtra, IsMultiple>\n    >;\n  };\n}\n\nexport default class PowerSelectBeforeOptionsComponent<\n  T = unknown,\n  TExtra = unknown,\n  IsMultiple extends boolean = false,\n> extends Component<PowerSelectBeforeOptionsSignature<T, TExtra, IsMultiple>> {\n  didSetup: boolean = false;\n\n  @action\n  handleKeydown(e: KeyboardEvent): false | void {\n    if (this.args.onKeydown(e) === false) {\n      return false;\n    }\n    if (e.key === 'Enter') {\n      this.args.select.actions.close(e);\n    }\n  }\n\n  @action\n  handleInput(event: Event): false | void {\n    const e = event as InputEvent;\n    if (this.args.onInput(e) === false) {\n      return false;\n    }\n  }\n\n  setupInput = modifier(\n    (el: HTMLElement) => {\n      if (this.didSetup) {\n        return;\n      }\n\n      this.didSetup = true;\n\n      this._focusInput(el);\n\n      return () => {\n        this.args.select.actions?.search('');\n      };\n    },\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    { eager: false },\n  );\n\n  private _focusInput(el: HTMLElement) {\n    void this.focusLaterTask.perform(el);\n  }\n\n  private focusLaterTask = task(async (el: HTMLElement) => {\n    await timeout(0);\n    if (this.args.autofocus !== false) {\n      el.focus();\n    }\n  });\n\n  <template>\n    {{#if\n      (and\n        @searchEnabled\n        (or\n          (eq @searchFieldPosition \"before-options\")\n          (eq @searchFieldPosition undefined)\n        )\n      )\n    }}\n      <div class=\"ember-power-select-search\">\n        {{! template-lint-disable require-input-label }}\n        <input\n          type=\"search\"\n          autocomplete=\"off\"\n          autocorrect=\"off\"\n          autocapitalize=\"off\"\n          spellcheck={{false}}\n          class=\"ember-power-select-search-input\"\n          value={{@select.searchText}}\n          role={{or @role \"combobox\"}}\n          aria-activedescendant={{@ariaActiveDescendant}}\n          aria-controls={{@listboxId}}\n          aria-owns={{@listboxId}}\n          aria-autocomplete=\"list\"\n          aria-haspopup=\"listbox\"\n          aria-expanded={{if @select.isOpen \"true\" \"false\"}}\n          placeholder={{@searchPlaceholder}}\n          aria-label={{@ariaLabel}}\n          aria-labelledby={{@ariaLabelledBy}}\n          aria-describedby={{@ariaDescribedBy}}\n          {{on \"input\" this.handleInput}}\n          {{on \"focus\" @onFocus}}\n          {{on \"blur\" @onBlur}}\n          {{on \"keydown\" this.handleKeydown}}\n          {{this.setupInput}}\n        />\n      </div>\n    {{/if}}\n  </template>\n}\n"],"names":["PowerSelectBeforeOptionsComponent","Component","didSetup","handleKeydown","e","args","onKeydown","key","select","actions","close","n","prototype","action","handleInput","event","onInput","setupInput","modifier","el","_focusInput","search","eager","focusLaterTask","perform","_buildTask","context","generator","timeout","autofocus","focus","setComponentTemplate","precompileTemplate","strictMode","scope","and","or","eq","on"],"mappings":";;;;;;;;;;;AAgDe,MAAMA,iCAAA,SAIXC,SAAA,CAAuD;AAC/DC,EAAAA,QAAA,GAAoB,KAAA;EAGpBC,aAAAA,CAAcC,CAAgB,EAAgB;IAC5C,IAAI,IAAI,CAACC,IAAI,CAACC,SAAS,CAACF,OAAO,KAAA,EAAO;AACpC,MAAA,OAAO,KAAA;AACT,IAAA;AACA,IAAA,IAAIA,CAAA,CAAEG,GAAG,KAAK,OAAA,EAAS;MACrB,IAAI,CAACF,IAAI,CAACG,MAAM,CAACC,OAAO,CAACC,KAAK,CAACN,CAAA,CAAA;AACjC,IAAA;AACF,EAAA;AAAA,EAAA;IAAAO,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,eAAA,EAAA,CARCC,MAAA,CAAA,CAAA;AAAA;EAWDC,WAAAA,CAAYC,KAAY,EAAgB;IACtC,MAAMX,IAAIW,KAAS;IACnB,IAAI,IAAI,CAACV,IAAI,CAACW,OAAO,CAACZ,OAAO,KAAA,EAAO;AAClC,MAAA,OAAO,KAAA;AACT,IAAA;AACF,EAAA;AAAA,EAAA;IAAAO,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,aAAA,EAAA,CANCC,MAAA,CAAA,CAAA;AAAA;AAQDI,EAAAA,UAAA,GAAaC,QAAA,CACVC,EAAI,IAAA;IACH,IAAI,IAAI,CAACjB,QAAQ,EAAE;AACjB,MAAA;AACF,IAAA;IAEA,IAAI,CAACA,QAAQ,GAAG,IAAA;AAEhB,IAAA,IAAI,CAACkB,WAAW,CAACD,EAAA,CAAA;AAEjB,IAAA,OAAO,MAAA;MACL,IAAI,CAACd,IAAI,CAACG,MAAM,CAACC,OAAO,EAAEY,MAAA,CAAO,EAAA,CAAA;IACnC,CAAA;EACF,CAAA;AACA;AACA;AACA,EAAA;AAAEC,IAAAA,KAAA,EAAO;AAAM,GAAA,CAAA;EAGTF,WAAAA,CAAYD,EAAe,EAAE;AACnC,IAAA,KAAK,IAAI,CAACI,cAAc,CAACC,OAAO,CAACL,EAAA,CAAA;AACnC,EAAA;AAEQI,EAAAA,cAAA,GAAAE,SAAA,CAAA,OAAA;IAAAC,OAAA,EAAA,IAAA;IAAAC,SAAA,EAAA,WAA6BR,EAAI,EAAA;MACvC,MAAMS,OAAA,CAAQ,CAAA,CAAA;AACd,MAAA,IAAI,IAAI,CAACvB,IAAI,CAACwB,SAAS,KAAK,KAAA,EAAO;QACjCV,EAAA,CAAGW,KAAK,EAAA;AACV,MAAA;AACF,IAAA;AAAA,GAAA,CAAA,EAAA,IAAA,EAAA,gBAAA,EAAA,IAAA,CAAA;AAEA,EAAA;IAAAC,oBAAA,CAAAC,kBAAA,CAAA,+6BAAA,EAuCA;MAAAC,UAAA,EAAA,IAAA;AAAAC,MAAAA,KAAA,EAAAA,OAAA;QAAAC,GAAA;QAAAC,EAAA;QAAAC,EAAA;AAAAC,QAAAA;AAAA,OAAA;KAAU,CAAA,EAAV,IAAW,CAAA;AAAD;AACZ;;;;"}