{"version":3,"file":"options.js","sources":["../../../src/components/power-select/options.ts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { action } from '@ember/object';\nimport { modifier } from 'ember-modifier';\nimport type { Select } from '../power-select';\nimport type { ComponentLike } from '@glint/template';\nimport { deprecate } from '@ember/debug';\ndeclare const FastBoot: any;\n\ninterface PowerSelectOptionsSignature {\n  Element: HTMLElement;\n  Args: PowerSelectOptionsArgs;\n  Blocks: {\n    default: [opt: PowerSelectOptionsArgs, select: Select];\n  };\n}\n\ninterface PowerSelectOptionsArgs {\n  select: Select;\n  highlightOnHover?: boolean;\n  listboxId: string;\n  groupIndex: string;\n  loadingMessage: string;\n  options: any[];\n  extra: any;\n  groupComponent?: string | ComponentLike<any>;\n  optionsComponent?: string | ComponentLike<any>;\n}\n\nconst isTouchDevice = !!window && 'ontouchstart' in window;\nif (typeof FastBoot === 'undefined') {\n  (function (ElementProto) {\n    if (typeof ElementProto.matches !== 'function') {\n      ElementProto.matches =\n        (ElementProto as any).msMatchesSelector ||\n        (ElementProto as any).mozMatchesSelector ||\n        ElementProto.webkitMatchesSelector;\n    }\n\n    if (typeof ElementProto.closest !== 'function') {\n      ElementProto.closest = function closest(selector: string) {\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        let element: Element | null = this;\n        while (element !== null && element.nodeType === 1) {\n          if (element.matches(selector)) {\n            return element;\n          }\n          element = element.parentNode as Element;\n        }\n        return null;\n      };\n    }\n  })(window.Element.prototype);\n}\n\nexport default class PowerSelectOptionsComponent extends Component<PowerSelectOptionsSignature> {\n  private isTouchDevice = this.args.extra?._isTouchDevice || isTouchDevice;\n  private touchMoveEvent?: TouchEvent;\n  private mouseOverHandler: EventListener = ((\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    _: MouseEvent,\n  ): void => {}) as EventListener;\n  private mouseUpHandler: EventListener = ((\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    _: MouseEvent,\n  ): void => {}) as EventListener;\n  private touchEndHandler: EventListener = ((\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    _: TouchEvent,\n  ): void => {}) as EventListener;\n  private touchMoveHandler: EventListener = ((\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    _: TouchEvent,\n  ): void => {}) as EventListener;\n  private touchStartHandler: EventListener = ((\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    _: TouchEvent,\n  ): void => {}) as EventListener;\n\n  private _listElement: Element | null = null;\n  private _didHandlerSetup: boolean = false;\n\n  willDestroy(): void {\n    super.willDestroy();\n    if (this._listElement) {\n      this._removeHandlers(this._listElement);\n    }\n  }\n\n  @action\n  addHandlers(element: Element) {\n    deprecate(\n      'You are using power-select options component with ember/render-modifier. Replace {{did-insert this.addHandlers}} with {{this.setupHandlers}}.',\n      false,\n      {\n        for: 'ember-power-select',\n        id: 'ember-power-select.no-at-ember-render-modifiers',\n        since: {\n          enabled: '8.1',\n          available: '8.1',\n        },\n        until: '9.0.0',\n      },\n    );\n\n    this._addHandlers(element);\n  }\n\n  @action\n  removeHandlers(element: Element) {\n    deprecate(\n      'You are using power-select options component with ember/render-modifier. Replace {{will-destroy this.removeHandlers}} with {{this.setupHandlers}}.',\n      false,\n      {\n        for: 'ember-power-select',\n        id: 'ember-power-select.no-at-ember-render-modifiers',\n        since: {\n          enabled: '8.1',\n          available: '8.1',\n        },\n        until: '9.0.0',\n      },\n    );\n\n    this._removeHandlers(element);\n  }\n\n  setupHandlers = modifier((element: Element) => {\n    if (this._didHandlerSetup) {\n      return;\n    }\n    this._didHandlerSetup = true;\n    this._listElement = element;\n    this._addHandlers(element);\n  });\n\n  _optionFromIndex(index: string) {\n    const parts = index.split('.');\n    let option = this.args.options[parseInt(parts[0] ?? '', 10)];\n    for (let i = 1; i < parts.length; i++) {\n      option = option.options[parseInt(parts[i] ?? '', 10)];\n    }\n    return option;\n  }\n\n  _hasMoved(endEvent: TouchEvent): boolean {\n    const moveEvent = this.touchMoveEvent;\n    if (!moveEvent) {\n      return false;\n    }\n\n    if (!moveEvent.changedTouches) {\n      return false;\n    }\n\n    if (\n      !endEvent.changedTouches?.[0] ||\n      (moveEvent.changedTouches[0] as any).touchType !== 'stylus'\n    ) {\n      return true;\n    }\n\n    const changedTouch = moveEvent.changedTouches[0];\n\n    // Distinguish stylus scroll and tap: if touch \"distance\" < 5px, we consider it a tap\n    const horizontalDistance = Math.abs(\n      (changedTouch?.pageX ?? 0) - endEvent.changedTouches[0].pageX,\n    );\n    const verticalDistance = Math.abs(\n      (changedTouch?.pageY ?? 0) - endEvent.changedTouches[0].pageY,\n    );\n    return horizontalDistance >= 5 || verticalDistance >= 5;\n  }\n\n  private _addHandlers(element: Element) {\n    const isGroup = element.getAttribute('data-optgroup') === 'true';\n    if (isGroup) {\n      return;\n    }\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-function-type\n    const findOptionAndPerform = (action: Function, e: MouseEvent): void => {\n      if (e.target === null) return;\n      const optionItem = (e.target as Element).closest('[data-option-index]');\n      if (!optionItem) {\n        return;\n      }\n      if (optionItem.closest('[aria-disabled=true]')) {\n        return; // Abort if the item or an ancestor is disabled\n      }\n      const optionIndex = optionItem.getAttribute('data-option-index');\n      if (optionIndex === null) return;\n      action(this._optionFromIndex(optionIndex), e);\n    };\n    this.mouseUpHandler = ((e: MouseEvent): void =>\n      findOptionAndPerform(\n        this.args.select.actions.choose,\n        e,\n      )) as EventListener;\n    element.addEventListener('mouseup', this.mouseUpHandler);\n    if (this.args.highlightOnHover) {\n      this.mouseOverHandler = ((e: MouseEvent): void =>\n        findOptionAndPerform(\n          this.args.select.actions.highlight,\n          e,\n        )) as EventListener;\n      element.addEventListener('mouseover', this.mouseOverHandler);\n    }\n    if (this.isTouchDevice) {\n      this.touchMoveHandler = ((e: TouchEvent): void => {\n        this.touchMoveEvent = e;\n        if (element) {\n          element.removeEventListener('touchmove', this.touchMoveHandler);\n        }\n      }) as EventListener;\n      // Add touch event handlers to detect taps\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      this.touchStartHandler = ((_: TouchEvent): void => {\n        element.addEventListener('touchmove', this.touchMoveHandler);\n      }) as EventListener;\n      this.touchEndHandler = ((e: TouchEvent): void => {\n        if (e.target === null) return;\n        const optionItem = (e.target as Element).closest('[data-option-index]');\n        if (optionItem === null) return;\n        e.preventDefault();\n        if (this._hasMoved(e)) {\n          this.touchMoveEvent = undefined;\n          return;\n        }\n\n        if (optionItem.closest('[aria-disabled=true]')) {\n          return; // Abort if the item or an ancestor is disabled\n        }\n\n        const optionIndex = optionItem.getAttribute('data-option-index');\n        if (optionIndex === null) return;\n        this.args.select.actions.choose(this._optionFromIndex(optionIndex), e);\n      }) as EventListener;\n      element.addEventListener('touchstart', this.touchStartHandler);\n      element.addEventListener('touchend', this.touchEndHandler);\n    }\n\n    this.args.select.actions.scrollTo(this.args.select.highlighted);\n  }\n\n  private _removeHandlers(element: Element) {\n    element.removeEventListener('mouseup', this.mouseUpHandler);\n    element.removeEventListener('mouseover', this.mouseOverHandler);\n    element.removeEventListener('touchstart', this.touchStartHandler);\n    element.removeEventListener('touchmove', this.touchMoveHandler);\n    element.removeEventListener('touchend', this.touchEndHandler);\n  }\n}\n"],"names":["isTouchDevice","window","FastBoot","ElementProto","matches","msMatchesSelector","mozMatchesSelector","webkitMatchesSelector","closest","selector","element","nodeType","parentNode","Element","prototype","PowerSelectOptionsComponent","Component","args","extra","_isTouchDevice","touchMoveEvent","mouseOverHandler","_","mouseUpHandler","touchEndHandler","touchMoveHandler","touchStartHandler","_listElement","_didHandlerSetup","willDestroy","_removeHandlers","addHandlers","deprecate","for","id","since","enabled","available","until","_addHandlers","n","action","removeHandlers","setupHandlers","modifier","_optionFromIndex","index","parts","split","option","options","parseInt","i","length","_hasMoved","endEvent","moveEvent","changedTouches","touchType","changedTouch","horizontalDistance","Math","abs","pageX","verticalDistance","pageY","isGroup","getAttribute","findOptionAndPerform","e","target","optionItem","optionIndex","select","actions","choose","addEventListener","highlightOnHover","highlight","removeEventListener","preventDefault","undefined","scrollTo","highlighted","setComponentTemplate","TEMPLATE"],"mappings":"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"}