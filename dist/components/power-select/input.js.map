{"version":3,"file":"input.js","sources":["../../../src/components/power-select/input.ts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { action } from '@ember/object';\nimport { modifier } from 'ember-modifier';\nimport { assert, deprecate } from '@ember/debug';\nimport { isBlank } from '@ember/utils';\nimport { get } from '@ember/object';\nimport type { Select, TSearchFieldPosition } from '../power-select';\nimport { task, timeout } from 'ember-concurrency';\nimport type { ComponentLike } from '@glint/template';\n\nexport interface PowerSelectInputSignature {\n  Element: HTMLElement;\n  Args: {\n    select: Select;\n    ariaLabel?: string;\n    ariaLabelledBy?: string;\n    ariaDescribedBy?: string;\n    role?: string;\n    searchField?: string;\n    searchPlaceholder?: string;\n    placeholder?: string;\n    searchFieldPosition?: TSearchFieldPosition;\n    ariaActiveDescendant?: string;\n    isDefaultPlaceholder?: boolean;\n    listboxId?: string;\n    autofocus?: boolean;\n    tabindex?: number | string;\n    placeholderComponent?: string | ComponentLike<any>;\n    onKeydown?: (e: KeyboardEvent) => boolean | void;\n    onBlur?: (e: FocusEvent) => void;\n    onFocus?: (e: FocusEvent) => void;\n    onInput?: (e: InputEvent) => void | boolean;\n    buildSelection: (lastSelection: any, select: Select) => any[];\n  };\n}\n\nexport default class PowerSelectInput extends Component<PowerSelectInputSignature> {\n  didSetup: boolean = false;\n\n  private _lastIsOpen: boolean = this.args.select.isOpen;\n\n  get placeholder() {\n    if (this.args.placeholder !== undefined) {\n      deprecate(\n        'You are using `power-select/input-field` with parameter @placeholder. Replace @placeholder with @searchPlaceholder',\n        false,\n        {\n          for: 'ember-power-select',\n          id: 'ember-power-select.deprecate-input-field-placeholder-argument',\n          since: {\n            enabled: '8.11',\n            available: '8.11',\n          },\n          until: '9.0.0',\n        },\n      );\n    }\n\n    if (!this.args.isDefaultPlaceholder) {\n      return undefined;\n    }\n\n    if (this.args.select.multiple) {\n      return !this.args.select.selected ||\n        (Array.isArray(this.args.select.selected) &&\n          this.args.select.selected.length === 0)\n        ? this.args.placeholder || this.args.searchPlaceholder || ''\n        : '';\n    }\n\n    return this.args.placeholder || this.args.searchPlaceholder;\n  }\n\n  @action\n  handleKeydown(e: KeyboardEvent): false | void {\n    if (e.target === null) return;\n    if (this.args.onKeydown && this.args.onKeydown(e) === false) {\n      e.stopPropagation();\n      return false;\n    }\n    if (this.args.select.multiple) {\n      if (e.keyCode === 8) {\n        e.stopPropagation();\n        if (\n          isBlank((e.target as HTMLInputElement).value) &&\n          this.args.buildSelection\n        ) {\n          const lastSelection =\n            Array.isArray(this.args.select.selected) &&\n            this.args.select.selected[this.args.select.selected.length - 1];\n          if (lastSelection) {\n            this.args.select.actions.select(\n              this.args.buildSelection(lastSelection, this.args.select),\n              e,\n            );\n            if (typeof lastSelection === 'string') {\n              this.args.select.actions.search(lastSelection);\n            } else {\n              assert(\n                '`<PowerSelect>` requires a `@searchField` when the options are not strings to remove options using backspace',\n                this.args.searchField,\n              );\n              this.args.select.actions.search(\n                (get(lastSelection, this.args.searchField) || '') as string,\n              );\n            }\n            this.args.select.actions.open(e);\n          }\n        }\n      } else if ((e.keyCode >= 48 && e.keyCode <= 90) || e.keyCode === 32) {\n        // Keys 0-9, a-z or SPACE\n        e.stopPropagation();\n      }\n    } else if (e.keyCode === 13) {\n      this.args.select.actions.close(e);\n    }\n  }\n\n  @action\n  handleInput(event: Event): false | void {\n    const e = event as InputEvent;\n    if (this.args.onInput && this.args.onInput(e) === false) {\n      return false;\n    }\n\n    this.args.select.actions.open(e);\n  }\n\n  @action\n  handleBlur(event: Event) {\n    if (!this._lastIsOpen && this.args.searchFieldPosition === 'trigger') {\n      this.args.select.actions?.search('');\n    }\n\n    if (this.args.onBlur) {\n      this.args.onBlur(event as FocusEvent);\n    }\n  }\n\n  @action\n  handleFocus(event: Event) {\n    if (this.args.onFocus) {\n      this.args.onFocus(event as FocusEvent);\n    }\n  }\n\n  setupInput = modifier(\n    (el: HTMLElement) => {\n      if (this.didSetup) {\n        return;\n      }\n\n      this.didSetup = true;\n\n      if (\n        this.args.searchFieldPosition === undefined ||\n        this.args.searchFieldPosition === 'before-options'\n      ) {\n        this._focusInput(el);\n      }\n\n      return () => {\n        this.args.select.actions?.search('');\n      };\n    },\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    { eager: false },\n  );\n\n  openChange = modifier((element: HTMLElement, [isOpen]: [boolean]) => {\n    this._openChanged(element, [isOpen]);\n  });\n\n  private _openChanged(element: HTMLElement, [isOpen]: [boolean]) {\n    if (\n      isOpen === false &&\n      this._lastIsOpen === true &&\n      document.activeElement !== element\n    ) {\n      Promise.resolve().then(() => {\n        this.args.select.actions?.search('');\n      });\n    }\n    this._lastIsOpen = isOpen;\n  }\n\n  private _focusInput(el: HTMLElement) {\n    this.focusLaterTask.perform(el);\n  }\n\n  private focusLaterTask = task(async (el: HTMLElement) => {\n    await timeout(0);\n    if (this.args.autofocus !== false) {\n      el.focus();\n    }\n  });\n}\n"],"names":["PowerSelectInput","Component","didSetup","_lastIsOpen","args","select","isOpen","placeholder","undefined","deprecate","for","id","since","enabled","available","until","isDefaultPlaceholder","multiple","selected","Array","isArray","length","searchPlaceholder","handleKeydown","e","target","onKeydown","stopPropagation","keyCode","isBlank","value","buildSelection","lastSelection","actions","search","assert","searchField","get","open","close","n","prototype","action","handleInput","event","onInput","handleBlur","searchFieldPosition","onBlur","handleFocus","onFocus","setupInput","modifier","el","_focusInput","eager","openChange","element","_openChanged","document","activeElement","Promise","resolve","then","focusLaterTask","perform","_buildTask","context","generator","timeout","autofocus","focus","setComponentTemplate","TEMPLATE"],"mappings":"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"}